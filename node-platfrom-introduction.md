
# Node Platfrom introduction

## Node Basics

## Express.js

[Example](https://gist.github.com/yanivefraim/4930348959f9eeb240c337c9a4e90563):

```js
const express = require('express');

const app = express();

const reqTime = (req, res, next) => {
    req.reqTime = Date.now();
    next();
}

app.use(reqTime);

app.get('/api/games', (req, res) => {
    res.send('hello world ' + req.reqTime);
});

app.get('*', (req, res) => {
    res.send('my page ' + req.reqTime);
});

app.listen(3000);
```

## Yoshi server architecture

<img src="./architecture.png" alt="alt text" width="450px">

We start by taking a look at the server which was generated by `create-yoshi-app`:

Server entry point is `index.js`:

```js
const bootstrap = require('@wix/wix-bootstrap-ng');

bootstrap()
  // https://github.com/wix-platform/wix-node-platform/tree/master/greynode/wix-bootstrap-greynode
  .use(require('@wix/wix-bootstrap-greynode'))
  // https://github.com/wix-platform/wix-node-platform/tree/master/bootstrap-plugins/hadron/wix-bootstrap-hadron
  .use(require('@wix/wix-bootstrap-hadron'))
  // https://github.com/wix-private/fed-infra/tree/master/wix-bootstrap-renderer
  .use(require('@wix/wix-bootstrap-renderer'))
  .express('./dist/server')
  .start();

```

`index.js` is pointing to our server file (`server.js`), which is the folowing function:

```ts
export default (app: Router, context) => {
    return app;
}
```

###### app

`app` is an [express router](https://expressjs.com/en/4x/api.html#router):

```js
  app.get('/', (req, res) => {
    res.send('hello there');
  });

```

We render our [`ejs`](https://github.com/mde/ejs) template using a the `res.renderView` method, added by `app.use(context.renderer.middleware());`, but we can start with a simple 'vanilla' ejs rendering:

```js
app.get('/', async (req, res) => {
    //{title: 'hello'} is the model for our ejs template
    const html = await ejs.renderFile('./src/index.ejs', {title: 'hello'});
    res.send(html);
});
```

###### context

`context` is the second argument injected to your server function. It contains several default objects, and can be enriched by using different `node-platform` plugins. See [context](https://github.com/wix-platform/wix-node-platform/tree/master/bootstrap/wix-bootstrap-ng#context) and [use](https://github.com/wix-platform/wix-node-platform/tree/master/bootstrap/wix-bootstrap-ng#wixbootstrapnguseobject-opts-this) for more details.

###### erb





